<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>WoWMania â€” Listings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <style>
        .listing-row {
            height: 40px;
            line-height: 40px;
            padding: 0 1rem;
            margin-bottom: 4px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .listings-container {
            max-height: calc((40px + 4px) * 10);
            overflow: hidden;
        }
    </style>
</head>
<body class="wow-background-1 text-white">

<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">WoWMania</a>

        <form th:action="@{/listings}" method="get" class="d-flex">
            <input name="q" class="form-control me-2" type="search"
                   th:value="${keyword}" placeholder="Search by title"/>
            <button class="btn btn-outline-light" type="submit">Search</button>
        </form>

        <a sec:authorize="hasRole('SELLER') or hasRole('ADMIN')"
           class="btn btn-warning ms-2" href="/listings/new">Add Listing</a>
    </div>
</nav>

<div class="container mt-4 listings-container">
    <div th:if="${#lists.isEmpty(listings)}" class="alert alert-info text-dark">
        No listings found.
    </div>

    <div th:each="lst : ${listings}" class="listing-row">
        <a th:href="@{/listings/{id}(id=${lst.id})}"
           class="text-white text-decoration-none" th:text="${lst.title}">Title</a>
        <div class="d-flex align-items-center">
            <span class="me-3" th:text="${lst.price + 'g'}">0g</span>
            <a sec:authorize="hasRole('BUYER') or hasRole('ADMIN')"
               th:href="@{/listings/{id}/buy(id=${lst.id})}"
               class="btn btn-sm btn-success">Add to Cart</a>
        </div>
    </div>
</div>

<nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
            <a class="page-link"
               th:href="@{/listings(q=${keyword},page=${currentPage - 1})}"
               aria-label="Previous">Previous</a>
        </li>
        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
            th:classappend="${i == currentPage} ? 'active'">
            <a class="page-link"
               th:href="@{/listings(q=${keyword},page=${i})}"
               th:text="${i + 1}">1</a>
        </li>
        <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
            <a class="page-link"
               th:href="@{/listings(q=${keyword},page=${currentPage + 1})}"
               aria-label="Next">Next</a>
        </li>
    </ul>
</nav>

</body>
</html>
